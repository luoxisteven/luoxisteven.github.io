"use strict";(self.webpackChunkreact=self.webpackChunkreact||[]).push([[13],{4013:(t,e,n)=>{n.r(e),n.d(e,{default:()=>p});var r=n(5043),o=n(9002),a=n(7353),i=n(3625),c=n(4056),l=n(5795),s=n(1906),d=n(1637),u=n(794),f=n(4194),h=n(4494),x=n(2141),m=n(330),C=n(6295),E=n(2678),v=n(4410),y=n(579);const p=()=>{const t=(0,o.Zp)(),{themeMode:e,language:n}=(0,r.useContext)(C.l),{userState:p}=(0,E.J)(),[N,S]=(0,r.useState)(0),[g,b]=(0,r.useState)({CN:{title:"",content:v.EditorState.createEmpty()},EN:{title:"",content:v.EditorState.createEmpty()}}),[w,A]=(0,r.useState)(!1),[j,k]=(0,r.useState)(""),[_,D]=(0,r.useState)("success"),[W,J]=(0,r.useState)(!1);(0,r.useEffect)((()=>{(async()=>{try{const t=await m.A.getDraft(p.username,p.access);if(t){const e=t.cn_content?v.EditorState.createWithContent((0,v.convertFromRaw)(JSON.parse(t.cn_content))):v.EditorState.createEmpty(),n=t.en_content?v.EditorState.createWithContent((0,v.convertFromRaw)(JSON.parse(t.en_content))):v.EditorState.createEmpty();b({CN:{title:t.cn_title||"",content:e},EN:{title:t.en_title||"",content:n}})}}catch(t){console.error("Error fetching draft:",t)}})()}),[p.access,p.username]),(0,r.useEffect)((()=>{const t=t=>{(t.ctrlKey||t.metaKey)&&"s"===t.key&&(t.preventDefault(),O())};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}}),[g]);const O=async()=>{const t={cn_title:g.CN.title,en_title:g.EN.title,author:p.username,cn_content:JSON.stringify((0,v.convertToRaw)(g.CN.content.getCurrentContent())),en_content:JSON.stringify((0,v.convertToRaw)(g.EN.content.getCurrentContent())),status:"draft"};try{await m.A.saveDraft(t,p.access);A(!0),k("cn"===n?"\u8349\u7a3f\u5df2\u4fdd\u5b58":"Draft saved"),D("success")}catch(e){A(!0),k("cn"===n?"\u4fdd\u5b58\u5931\u8d25":"Failed to save draft"),D("error")}},R={title:"cn"===n?"\u6807\u9898":"Title",content:"cn"===n?"\u5185\u5bb9":"Content",submit:"cn"===n?"\u63d0\u4ea4":"Submit",save:"cn"===n?"\u6682\u5b58":"Save",clear:"cn"===n?"\u6e05\u7a7a":"Clear"};return(0,y.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",height:"100vh",overflow:"hidden"},children:[(0,y.jsx)(h.A,{}),(0,y.jsxs)(a.A,{sx:{flex:1,display:"flex",flexDirection:"column",maxWidth:1e3,width:"100%",mx:"auto",mt:11,px:2,overflow:"hidden"},children:[(0,y.jsxs)(i.A,{value:N,onChange:(t,e)=>{S(e)},sx:{flexShrink:0},variant:"fullWidth",children:[(0,y.jsx)(c.A,{label:"CN"}),(0,y.jsx)(c.A,{label:"EN"})]}),(0,y.jsxs)(a.A,{component:"form",onSubmit:async e=>{e.preventDefault(),J(!0);const r={cn_title:g.CN.title,en_title:g.EN.title,author:p.username,cn_content:JSON.stringify((0,v.convertToRaw)(g.CN.content.getCurrentContent())),en_content:JSON.stringify((0,v.convertToRaw)(g.EN.content.getCurrentContent())),visible:!0};try{const e=await m.A.addBlog(r,p.access);console.log("Blog added successfully:",e),b({CN:{title:"",content:v.EditorState.createEmpty()},EN:{title:"",content:v.EditorState.createEmpty()}}),t("/blogs?updated=true")}catch(o){console.error("Error adding blog:",o),A(!0),k("cn"===n?"\u53d1\u5e03\u5931\u8d25":"Failed to publish blog"),D("error")}finally{J(!1)}},sx:{display:"flex",flexDirection:"column",flex:1,overflow:"hidden"},children:[(0,y.jsx)(l.A,{label:0===N?`${R.title} (CN)`:`${R.title} (EN)`,variant:"filled",value:0===N?g.CN.title:g.EN.title,onChange:t=>{return e=0===N?"CN":"EN",n="title",r=t.target.value,void b((t=>({...t,[e]:{...t[e],[n]:r}})));var e,n,r},fullWidth:!0,sx:{flexShrink:0,"& .MuiFilledInput-root":{backgroundColor:"transparent","&:hover":{backgroundColor:"transparent"},"&.Mui-focused":{backgroundColor:"transparent"}}}}),(0,y.jsx)(a.A,{sx:{flex:1,display:"flex",flexDirection:"column",minHeight:0},children:(0,y.jsx)(x.A,{editorState:0===N?g.CN.content:g.EN.content,onEditorStateChange:t=>((t,e)=>{b((n=>({...n,[t]:{...n[t],content:e}})))})(0===N?"CN":"EN",t)})}),(0,y.jsxs)(a.A,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:2,mb:2,flexShrink:0},children:[(0,y.jsx)(s.A,{variant:"outlined",color:"secondary",onClick:()=>{b({CN:{title:"",content:v.EditorState.createEmpty()},EN:{title:"",content:v.EditorState.createEmpty()}})},disabled:W,sx:{minWidth:85},children:R.clear}),(0,y.jsx)(s.A,{variant:"outlined",color:"primary",onClick:O,disabled:W,sx:{minWidth:85},children:R.save}),(0,y.jsx)(s.A,{type:"submit",variant:"contained",color:"primary",disabled:W,sx:{minWidth:90},children:W?(0,y.jsx)(d.A,{size:20}):R.submit})]})]})]}),(0,y.jsx)(u.A,{open:w,autoHideDuration:3e3,onClose:()=>{A(!1)},anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,y.jsx)(f.A,{severity:_,sx:{width:"100%"},children:j})})]})}}}]);
//# sourceMappingURL=13.58307ef0.chunk.js.map