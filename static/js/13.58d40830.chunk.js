"use strict";(self.webpackChunkreact=self.webpackChunkreact||[]).push([[13],{4013:(t,e,n)=>{n.r(e),n.d(e,{default:()=>y});var r=n(5043),o=n(9002),a=n(7353),c=n(3625),i=n(4056),l=n(5795),s=n(1906),d=n(794),u=n(4194),f=n(4494),h=n(2141),x=n(330),C=n(6295),E=n(2678),m=n(4410),v=n(579);const y=()=>{const t=(0,o.Zp)(),{themeMode:e,language:n}=(0,r.useContext)(C.l),{userState:y}=(0,E.J)(),[N,p]=(0,r.useState)(0),[g,S]=(0,r.useState)({CN:{title:"",content:m.EditorState.createEmpty()},EN:{title:"",content:m.EditorState.createEmpty()}}),[w,A]=(0,r.useState)(!1),[b,j]=(0,r.useState)(""),[k,_]=(0,r.useState)("success");(0,r.useEffect)((()=>{(async()=>{try{const t=await x.A.getDraft(y.username,y.access);if(t){const e=t.cn_content?m.EditorState.createWithContent((0,m.convertFromRaw)(JSON.parse(t.cn_content))):m.EditorState.createEmpty(),n=t.en_content?m.EditorState.createWithContent((0,m.convertFromRaw)(JSON.parse(t.en_content))):m.EditorState.createEmpty();S({CN:{title:t.cn_title||"",content:e},EN:{title:t.en_title||"",content:n}})}}catch(t){console.error("Error fetching draft:",t)}})()}),[y.access,y.username]),(0,r.useEffect)((()=>{const t=t=>{(t.ctrlKey||t.metaKey)&&"s"===t.key&&(t.preventDefault(),D())};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}}),[g]);const D=async()=>{const t={cn_title:g.CN.title,en_title:g.EN.title,author:y.username,cn_content:JSON.stringify((0,m.convertToRaw)(g.CN.content.getCurrentContent())),en_content:JSON.stringify((0,m.convertToRaw)(g.EN.content.getCurrentContent())),status:"draft"};try{await x.A.saveDraft(t,y.access);A(!0),j("cn"===n?"\u8349\u7a3f\u5df2\u4fdd\u5b58":"Draft saved"),_("success")}catch(e){A(!0),j("cn"===n?"\u4fdd\u5b58\u5931\u8d25":"Failed to save draft"),_("error")}},J={title:"cn"===n?"\u6807\u9898":"Title",content:"cn"===n?"\u5185\u5bb9":"Content",submit:"cn"===n?"\u63d0\u4ea4":"Submit",save:"cn"===n?"\u8349\u7a3f":"Draft",clear:"cn"===n?"\u6e05\u7a7a":"Clear"};return(0,v.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",height:"100vh",overflow:"hidden"},children:[(0,v.jsx)(f.A,{}),(0,v.jsxs)(a.A,{sx:{flex:1,display:"flex",flexDirection:"column",maxWidth:1e3,width:"100%",mx:"auto",mt:11,px:2,overflow:"hidden"},children:[(0,v.jsxs)(c.A,{value:N,onChange:(t,e)=>{p(e)},sx:{flexShrink:0},variant:"fullWidth",children:[(0,v.jsx)(i.A,{label:"CN"}),(0,v.jsx)(i.A,{label:"EN"})]}),(0,v.jsxs)(a.A,{component:"form",onSubmit:async e=>{e.preventDefault();const n={cn_title:g.CN.title,en_title:g.EN.title,author:y.username,cn_content:JSON.stringify((0,m.convertToRaw)(g.CN.content.getCurrentContent())),en_content:JSON.stringify((0,m.convertToRaw)(g.EN.content.getCurrentContent())),visible:!0};try{const e=await x.A.addBlog(n,y.access);console.log("Blog added successfully:",e),t("/blogs")}catch(r){console.error("Error adding blog:",r)}S({CN:{title:"",content:m.EditorState.createEmpty()},EN:{title:"",content:m.EditorState.createEmpty()}})},sx:{display:"flex",flexDirection:"column",flex:1,overflow:"hidden"},children:[(0,v.jsx)(l.A,{label:0===N?`${J.title} (CN)`:`${J.title} (EN)`,variant:"filled",value:0===N?g.CN.title:g.EN.title,onChange:t=>{return e=0===N?"CN":"EN",n="title",r=t.target.value,void S((t=>({...t,[e]:{...t[e],[n]:r}})));var e,n,r},fullWidth:!0,sx:{flexShrink:0,"& .MuiFilledInput-root":{backgroundColor:"transparent","&:hover":{backgroundColor:"transparent"},"&.Mui-focused":{backgroundColor:"transparent"}}}}),(0,v.jsx)(a.A,{sx:{flex:1,display:"flex",flexDirection:"column",minHeight:0},children:(0,v.jsx)(h.A,{editorState:0===N?g.CN.content:g.EN.content,onEditorStateChange:t=>((t,e)=>{S((n=>({...n,[t]:{...n[t],content:e}})))})(0===N?"CN":"EN",t)})}),(0,v.jsxs)(a.A,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:2,mb:2,flexShrink:0},children:[(0,v.jsx)(s.A,{variant:"outlined",color:"secondary",onClick:()=>{S({CN:{title:"",content:m.EditorState.createEmpty()},EN:{title:"",content:m.EditorState.createEmpty()}})},children:J.clear}),(0,v.jsx)(s.A,{variant:"outlined",color:"primary",onClick:D,children:J.save}),(0,v.jsx)(s.A,{type:"submit",variant:"contained",color:"primary",children:J.submit})]})]})]}),(0,v.jsx)(d.A,{open:w,autoHideDuration:3e3,onClose:()=>{A(!1)},anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,v.jsx)(u.A,{severity:k,sx:{width:"100%"},children:b})})]})}}}]);
//# sourceMappingURL=13.58d40830.chunk.js.map