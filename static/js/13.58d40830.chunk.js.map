{"version":3,"file":"static/js/13.58d40830.chunk.js","mappings":"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","sources":["pages/blog-pages/AddBlogPage.js"],"sourcesContent":["import { useContext, useState, useEffect } from \"react\";\nimport { useNavigate } from 'react-router-dom';\nimport { Box, Tabs, Tab, TextField, Button, Snackbar, Alert} from \"@mui/material\";\nimport CustomAppBar from \"../../components/shared-components/AppBar/AppBar\";\nimport DraftJsWysiwyg from \"../../components/blog-components/Draft-js-wysiwyg/Draft-js-wysiwyg\";\nimport BlogService from \"../../services/BlogService\";\nimport { SettingsContext } from \"../../context/SettingsContext\";\nimport { useUser } from \"../../context/UserContext\";\nimport {\n  EditorState,\n  convertToRaw,\n  convertFromRaw,\n} from \"draft-js\";\n\nconst AddBlogPage = () => {\n  const navigate = useNavigate();\n  const { themeMode, language } = useContext(SettingsContext);\n  const { userState } = useUser();\n\n  const [activeTab, setActiveTab] = useState(0);\n  const [tabsData, setTabsData] = useState({\n    CN: { title: \"\", content: EditorState.createEmpty() },\n    EN: { title: \"\", content: EditorState.createEmpty() },\n  });\n\n  const [snackbarOpen, setSnackbarOpen] = useState(false);\n  const [snackbarMessage, setSnackbarMessage] = useState(\"\");\n  const [snackbarSeverity, setSnackbarSeverity] = useState(\"success\");\n\n  // 关闭时触发\n  const handleSnackbarClose = () => {\n    setSnackbarOpen(false);\n  };\n\n  // -------------------\n  // 1) 组件挂载时，获取草稿\n  // -------------------\n  useEffect(() => {\n    const fetchDraft = async () => {\n      try {\n        const draft = await BlogService.getDraft(\n          userState.username, \n          userState.access\n        );\n        if (draft) {\n          const cnEditorState = draft.cn_content\n            ? EditorState.createWithContent(\n                convertFromRaw(JSON.parse(draft.cn_content))\n              )\n            : EditorState.createEmpty();\n\n          const enEditorState = draft.en_content\n            ? EditorState.createWithContent(\n                convertFromRaw(JSON.parse(draft.en_content))\n              )\n            : EditorState.createEmpty();\n\n          setTabsData({\n            CN: {\n              title: draft.cn_title || \"\",\n              content: cnEditorState,\n            },\n            EN: {\n              title: draft.en_title || \"\",\n              content: enEditorState,\n            },\n          });\n        }\n      } catch (error) {\n        console.error(\"Error fetching draft:\", error);\n      }\n    };\n\n    fetchDraft();\n  }, [userState.access, userState.username]);\n\n  // -------------------\n  // 2) 键盘快捷键监听：Ctrl + S 或 Cmd + S\n  // -------------------\n  useEffect(() => {\n    const handleKeyDown = (event) => {\n      if ((event.ctrlKey || event.metaKey) && event.key === \"s\") {\n        event.preventDefault();\n        handleSaveDraft();\n      }\n    };\n\n    window.addEventListener(\"keydown\", handleKeyDown);\n    return () => {\n      window.removeEventListener(\"keydown\", handleKeyDown);\n    };\n  }, [tabsData]);\n\n  // -------------------\n  // 选项卡切换\n  // -------------------\n  const handleTabChange = (event, newValue) => {\n    setActiveTab(newValue);\n  };\n\n  const handleInputChange = (langKey, field, value) => {\n    setTabsData((prev) => ({\n      ...prev,\n      [langKey]: { ...prev[langKey], [field]: value },\n    }));\n  };\n\n  const handleContentChange = (langKey, editorState) => {\n    setTabsData((prev) => ({\n      ...prev,\n      [langKey]: { ...prev[langKey], content: editorState },\n    }));\n  };\n\n  // -------------------\n  // 保存草稿逻辑\n  // -------------------\n  const handleSaveDraft = async () => {\n    const draftData = {\n      cn_title: tabsData.CN.title,\n      en_title: tabsData.EN.title,\n      author: userState.username,\n      cn_content: JSON.stringify(\n        convertToRaw(tabsData.CN.content.getCurrentContent())\n      ),\n      en_content: JSON.stringify(\n        convertToRaw(tabsData.EN.content.getCurrentContent())\n      ),\n      status: \"draft\",\n    };\n\n    try {\n      const response = await BlogService.saveDraft(draftData, userState.access);\n      setSnackbarOpen(true);\n      setSnackbarMessage(language === \"cn\" ? \"草稿已保存\" : \"Draft saved\");\n      setSnackbarSeverity(\"success\");\n    } catch (error) {\n      setSnackbarOpen(true);\n      setSnackbarMessage(language === \"cn\" ? \"保存失败\" : \"Failed to save draft\");\n      setSnackbarSeverity(\"error\");\n    }\n  };\n\n  // -------------------\n  // 提交发布新博客\n  // -------------------\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    const dataToSubmit = {\n      cn_title: tabsData.CN.title,\n      en_title: tabsData.EN.title,\n      author: userState.username,\n      cn_content: JSON.stringify(\n        convertToRaw(tabsData.CN.content.getCurrentContent())\n      ),\n      en_content: JSON.stringify(\n        convertToRaw(tabsData.EN.content.getCurrentContent())\n      ),\n      visible: true\n    };\n\n    try {\n      const response = await BlogService.addBlog(dataToSubmit, userState.access);\n      console.log(\"Blog added successfully:\", response);\n      navigate(\"/blogs\");\n    } catch (error) {\n      console.error(\"Error adding blog:\", error);\n    }\n\n    // 发布后重置输入\n    setTabsData({\n      CN: { title: \"\", content: EditorState.createEmpty() },\n      EN: { title: \"\", content: EditorState.createEmpty() },\n    });\n  };\n\n  // -------------------\n  // 额外：清空输入内容\n  // -------------------\n  const handleClear = () => {\n    setTabsData({\n      CN: { title: \"\", content: EditorState.createEmpty() },\n      EN: { title: \"\", content: EditorState.createEmpty() },\n    });\n  };\n\n  // -------------------\n  // 多语言标签\n  // -------------------\n  const labels = {\n    title: language === \"cn\" ? \"标题\" : \"Title\",\n    content: language === \"cn\" ? \"内容\" : \"Content\",\n    submit: language === \"cn\" ? \"提交\" : \"Submit\",\n    save: language === \"cn\" ? \"草稿\" : \"Draft\",\n    clear: language === \"cn\" ? \"清空\" : \"Clear\",\n  };\n\n  return (\n    <Box\n      sx={{\n        display: \"flex\",\n        flexDirection: \"column\",\n        height: \"100vh\", // 占据整个视口高度\n        overflow: \"hidden\", // 防止整个页面滚动\n      }}\n    >\n      <CustomAppBar />\n      <Box\n        sx={{\n          flex: 1,\n          display: \"flex\",\n          flexDirection: \"column\",\n          maxWidth: 1000,\n          width: \"100%\",\n          mx: \"auto\",\n          mt: 11  , // 减少顶部间距\n          px: 2, // 添加左右内边距\n          overflow: \"hidden\", // 防止这个容器滚动\n        }}\n      >\n        <Tabs\n          value={activeTab}\n          onChange={handleTabChange}\n          sx={{ flexShrink: 0 }} // flexShrink: 0 防止tabs被压缩\n          variant=\"fullWidth\"\n        >\n          <Tab label=\"CN\" />\n          <Tab label=\"EN\" />\n        </Tabs>\n\n        <Box\n          component=\"form\"\n          onSubmit={handleSubmit}\n          sx={{\n            display: \"flex\",\n            flexDirection: \"column\",\n            flex: 1, // 占据剩余空间\n            overflow: \"hidden\", // 防止form滚动\n          }}\n        >\n          <TextField\n            label={\n              activeTab === 0 \n                ? `${labels.title} (CN)` \n                : `${labels.title} (EN)`\n            }\n            variant=\"filled\"\n            value={\n              activeTab === 0 \n                ? tabsData.CN.title \n                : tabsData.EN.title\n            }\n            onChange={(e) =>\n              handleInputChange(\n                activeTab === 0 ? \"CN\" : \"EN\",\n                \"title\",\n                e.target.value\n              )\n            }\n            fullWidth\n            sx={{ \n              flexShrink: 0,\n              '& .MuiFilledInput-root': {\n                backgroundColor: 'transparent',\n                '&:hover': {\n                  backgroundColor: 'transparent',\n                },\n                '&.Mui-focused': {\n                  backgroundColor: 'transparent',\n                },\n              }\n            }}\n          />\n\n          {/* Editor容器 - 占据剩余空间并可滚动 */}\n          <Box\n            sx={{\n              flex: 1, // 占据剩余所有空间\n              display: \"flex\",\n              flexDirection: \"column\",\n              minHeight: 0, // 重要：允许flex子元素收缩\n            }}\n          >\n            <DraftJsWysiwyg\n              editorState={\n                activeTab === 0 \n                  ? tabsData.CN.content \n                  : tabsData.EN.content\n              }\n              onEditorStateChange={(editorState) =>\n                handleContentChange(\n                  activeTab === 0 ? \"CN\" : \"EN\",\n                  editorState\n                )\n              }\n            />\n          </Box>\n\n          <Box\n            sx={{\n              display: \"flex\",\n              justifyContent: \"flex-end\",\n              gap: 2,\n              mt: 2,\n              mb: 2,\n              flexShrink: 0, // 防止按钮区域被压缩\n            }}\n          >\n            <Button \n              variant=\"outlined\" \n              color=\"secondary\" \n              onClick={handleClear}\n            >\n              {labels.clear}\n            </Button>\n\n            <Button\n              variant=\"outlined\"\n              color=\"primary\"\n              onClick={handleSaveDraft}\n            >\n              {labels.save}\n            </Button>\n\n            <Button \n              type=\"submit\" \n              variant=\"contained\" \n              color=\"primary\"\n            >\n              {labels.submit}\n            </Button>\n          </Box>\n        </Box>\n      </Box>\n\n      {/* Snackbar + Alert 提示条 */}\n      <Snackbar\n        open={snackbarOpen}\n        autoHideDuration={3000} \n        onClose={handleSnackbarClose}\n        anchorOrigin={{ vertical: \"top\", horizontal: \"center\" }} \n      >\n        <Alert \n          severity={snackbarSeverity} \n          sx={{ width: \"100%\" }}\n        >\n          {snackbarMessage}\n        </Alert>\n      </Snackbar>\n    </Box>\n  );\n};\n\nexport default AddBlogPage;"],"names":["AddBlogPage","navigate","useNavigate","themeMode","language","useContext","SettingsContext","userState","useUser","activeTab","setActiveTab","useState","tabsData","setTabsData","CN","title","content","EditorState","createEmpty","EN","snackbarOpen","setSnackbarOpen","snackbarMessage","setSnackbarMessage","snackbarSeverity","setSnackbarSeverity","useEffect","async","draft","BlogService","getDraft","username","access","cnEditorState","cn_content","createWithContent","convertFromRaw","JSON","parse","enEditorState","en_content","cn_title","en_title","error","console","fetchDraft","handleKeyDown","event","ctrlKey","metaKey","key","preventDefault","handleSaveDraft","window","addEventListener","removeEventListener","draftData","author","stringify","convertToRaw","getCurrentContent","status","saveDraft","labels","submit","save","clear","_jsxs","Box","sx","display","flexDirection","height","overflow","children","_jsx","CustomAppBar","flex","maxWidth","width","mx","mt","px","Tabs","value","onChange","handleTabChange","newValue","flexShrink","variant","Tab","label","component","onSubmit","e","dataToSubmit","visible","response","addBlog","log","TextField","handleInputChange","langKey","field","target","prev","fullWidth","backgroundColor","minHeight","DraftJsWysiwyg","editorState","onEditorStateChange","handleContentChange","justifyContent","gap","mb","Button","color","onClick","handleClear","type","Snackbar","open","autoHideDuration","onClose","handleSnackbarClose","anchorOrigin","vertical","horizontal","Alert","severity"],"sourceRoot":""}