{"version":3,"file":"static/js/426.51192b8d.chunk.js","mappings":"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","sources":["pages/blog-pages/EditBlogPage.js"],"sourcesContent":["import { useContext, useState, useEffect } from \"react\";\r\nimport { Box, Tabs, Tab, TextField, Button, Snackbar, Alert, CircularProgress } from \"@mui/material\";\r\nimport { useParams, useNavigate } from \"react-router-dom\";\r\nimport CustomAppBar from \"../../components/shared-components/AppBar/AppBar\";\r\nimport DraftJsWysiwyg from \"../../components/blog-components/Draft-js-wysiwyg/Draft-js-wysiwyg\";\r\nimport BlogService from \"../../services/BlogService\";\r\nimport { SettingsContext } from \"../../context/SettingsContext\";\r\nimport { useUser } from \"../../context/UserContext\";\r\nimport { EditorState, convertToRaw, convertFromRaw } from \"draft-js\";\r\n\r\nconst EditBlogPage = () => {\r\n  const navigate = useNavigate();\r\n  const { blogID } = useParams();\r\n  const { themeMode, language } = useContext(SettingsContext);\r\n  const { userState } = useUser();\r\n\r\n  const [activeTab, setActiveTab] = useState(0);\r\n  const [tabsData, setTabsData] = useState({\r\n    CN: { title: \"\", content: EditorState.createEmpty() },\r\n    EN: { title: \"\", content: EditorState.createEmpty() },\r\n  });\r\n\r\n  // 新增：保存原版数据\r\n  const [originalData, setOriginalData] = useState({\r\n    CN: { title: \"\", content: EditorState.createEmpty() },\r\n    EN: { title: \"\", content: EditorState.createEmpty() },\r\n  });\r\n\r\n  const [snackbarOpen, setSnackbarOpen] = useState(false);\r\n  const [snackbarMessage, setSnackbarMessage] = useState(\"\");\r\n  const [snackbarSeverity, setSnackbarSeverity] = useState(\"success\");\r\n  \r\n  // 添加提交状态\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n\r\n  const handleSnackbarClose = () => {\r\n    setSnackbarOpen(false);\r\n  };\r\n\r\n  // 获取博客详情数据\r\n  useEffect(() => {\r\n    const fetchBlogData = async () => {\r\n      try {\r\n        const blogData = await BlogService.getBlog(blogID, userState.access);\r\n        const initialData = {\r\n          CN: {\r\n            title: blogData.cn_title || \"\",\r\n            content: EditorState.createWithContent(convertFromRaw(JSON.parse(blogData.cn_content))),\r\n          },\r\n          EN: {\r\n            title: blogData.en_title || \"\",\r\n            content: EditorState.createWithContent(convertFromRaw(JSON.parse(blogData.en_content))),\r\n          },\r\n        };\r\n        \r\n        // 同时设置当前编辑数据和原版数据\r\n        setTabsData(initialData);\r\n        setOriginalData(initialData);\r\n      } catch (error) {\r\n        console.error(\"Error fetching blog data:\", error);\r\n      }\r\n    };\r\n\r\n    fetchBlogData();\r\n  }, [blogID, userState.access]);\r\n\r\n  const handleTabChange = (event, newValue) => {\r\n    setActiveTab(newValue);\r\n  };\r\n\r\n  const handleInputChange = (langKey, field, value) => {\r\n    setTabsData((prev) => ({\r\n      ...prev,\r\n      [langKey]: { ...prev[langKey], [field]: value },\r\n    }));\r\n  };\r\n\r\n  const handleContentChange = (langKey, editorState) => {\r\n    setTabsData((prev) => ({\r\n      ...prev,\r\n      [langKey]: { ...prev[langKey], content: editorState },\r\n    }));\r\n  };\r\n\r\n  // 新增：恢复原版数据的处理函数\r\n  const handleRestoreOriginal = () => {\r\n    setTabsData(originalData);\r\n    setSnackbarMessage(language === \"cn\" ? \"已恢复到原始内容\" : \"Restored to original content\");\r\n    setSnackbarSeverity(\"info\");\r\n    setSnackbarOpen(true);\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n\r\n    // 开始提交，设置loading状态\r\n    setIsSubmitting(true);\r\n\r\n    const dataToSubmit = {\r\n      cn_title: tabsData.CN.title,\r\n      en_title: tabsData.EN.title,\r\n      author: userState.username,\r\n      cn_content: JSON.stringify(convertToRaw(tabsData.CN.content.getCurrentContent())),\r\n      en_content: JSON.stringify(convertToRaw(tabsData.EN.content.getCurrentContent())),\r\n    };\r\n\r\n    try {\r\n      await BlogService.editBlog(blogID, dataToSubmit, userState.access);\r\n      navigate(`/blog/${blogID}?updated=true`);\r\n    } catch (error) {\r\n      console.error(\"Error editing blog:\", error);\r\n      setSnackbarMessage(language === \"cn\" ? \"更新失败\" : \"Failed to update blog\");\r\n      setSnackbarSeverity(\"error\");\r\n      setSnackbarOpen(true);\r\n    } finally {\r\n      // 无论成功还是失败，都要结束loading状态\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  const labels = {\r\n    title: language === \"cn\" ? \"标题\" : \"Title\",\r\n    content: language === \"cn\" ? \"内容\" : \"Content\",\r\n    submit: language === \"cn\" ? \"提交\" : \"Submit\",\r\n    restore: language === \"cn\" ? \"恢复\" : \"Restore\",\r\n  };\r\n\r\n  return (\r\n    <Box sx={{ display: \"flex\", flexDirection: \"column\", height: \"100vh\", overflow: \"hidden\" }}>\r\n      <CustomAppBar />\r\n      <Box\r\n        sx={{\r\n          flex: 1,\r\n          display: \"flex\",\r\n          flexDirection: \"column\",\r\n          maxWidth: 1000,\r\n          width: \"100%\",\r\n          mx: \"auto\",\r\n          mt: 11,\r\n          px: 2,\r\n          overflow: \"hidden\",\r\n        }}\r\n      >\r\n        <Tabs\r\n          value={activeTab}\r\n          onChange={handleTabChange}\r\n          sx={{ flexShrink: 0 }}\r\n          variant=\"fullWidth\"\r\n        >\r\n          <Tab label=\"CN\" />\r\n          <Tab label=\"EN\" />\r\n        </Tabs>\r\n\r\n        <Box\r\n          component=\"form\"\r\n          onSubmit={handleSubmit}\r\n          sx={{\r\n            display: \"flex\",\r\n            flexDirection: \"column\",\r\n            flex: 1,\r\n            overflow: \"hidden\",\r\n          }}\r\n        >\r\n          <TextField\r\n            label={\r\n              activeTab === 0 ? `${labels.title} (CN)` : `${labels.title} (EN)`\r\n            }\r\n            variant=\"filled\"\r\n            value={activeTab === 0 ? tabsData.CN.title : tabsData.EN.title}\r\n            onChange={(e) =>\r\n              handleInputChange(activeTab === 0 ? \"CN\" : \"EN\", \"title\", e.target.value)\r\n            }\r\n            fullWidth\r\n            sx={{\r\n              flexShrink: 0,\r\n              '& .MuiFilledInput-root': {\r\n                backgroundColor: 'transparent',\r\n                '&:hover': { backgroundColor: 'transparent' },\r\n                '&.Mui-focused': { backgroundColor: 'transparent' },\r\n              },\r\n            }}\r\n          />\r\n\r\n          <Box\r\n            sx={{\r\n              flex: 1,\r\n              display: \"flex\",\r\n              flexDirection: \"column\",\r\n              minHeight: 0,\r\n            }}\r\n          >\r\n            <DraftJsWysiwyg\r\n              editorState={activeTab === 0 ? tabsData.CN.content : tabsData.EN.content}\r\n              onEditorStateChange={(editorState) =>\r\n                handleContentChange(activeTab === 0 ? \"CN\" : \"EN\", editorState)\r\n              }\r\n            />\r\n          </Box>\r\n\r\n          <Box\r\n            sx={{\r\n              display: \"flex\",\r\n              justifyContent: \"flex-end\",\r\n              gap: 2,\r\n              mt: 2,\r\n              mb: 2,\r\n              flexShrink: 0,\r\n            }}\r\n          >\r\n            <Button \r\n              type=\"button\"\r\n              variant=\"outlined\" \r\n              color=\"secondary\"\r\n              onClick={handleRestoreOriginal}\r\n              disabled={isSubmitting}\r\n              sx={{ minWidth: 90 }}\r\n            >\r\n              {labels.restore}\r\n            </Button>\r\n            <Button \r\n              type=\"submit\" \r\n              variant=\"contained\" \r\n              color=\"primary\"\r\n              disabled={isSubmitting}\r\n              sx={{ minWidth: 90 }}\r\n            >\r\n              {isSubmitting ? <CircularProgress size={20} /> : labels.submit}\r\n            </Button>\r\n          </Box>\r\n        </Box>\r\n      </Box>\r\n\r\n      <Snackbar\r\n        open={snackbarOpen}\r\n        autoHideDuration={3000}\r\n        onClose={handleSnackbarClose}\r\n        anchorOrigin={{ vertical: \"top\", horizontal: \"center\" }}\r\n      >\r\n        <Alert severity={snackbarSeverity} sx={{ width: \"100%\" }}>\r\n          {snackbarMessage}\r\n        </Alert>\r\n      </Snackbar>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default EditBlogPage;"],"names":["EditBlogPage","navigate","useNavigate","blogID","useParams","themeMode","language","useContext","SettingsContext","userState","useUser","activeTab","setActiveTab","useState","tabsData","setTabsData","CN","title","content","EditorState","createEmpty","EN","originalData","setOriginalData","snackbarOpen","setSnackbarOpen","snackbarMessage","setSnackbarMessage","snackbarSeverity","setSnackbarSeverity","isSubmitting","setIsSubmitting","useEffect","async","blogData","BlogService","getBlog","access","initialData","cn_title","createWithContent","convertFromRaw","JSON","parse","cn_content","en_title","en_content","error","console","fetchBlogData","labels","submit","restore","_jsxs","Box","sx","display","flexDirection","height","overflow","children","_jsx","CustomAppBar","flex","maxWidth","width","mx","mt","px","Tabs","value","onChange","handleTabChange","event","newValue","flexShrink","variant","Tab","label","component","onSubmit","e","preventDefault","dataToSubmit","author","username","stringify","convertToRaw","getCurrentContent","editBlog","TextField","handleInputChange","langKey","field","target","prev","fullWidth","backgroundColor","minHeight","DraftJsWysiwyg","editorState","onEditorStateChange","handleContentChange","justifyContent","gap","mb","Button","type","color","onClick","handleRestoreOriginal","disabled","minWidth","CircularProgress","size","Snackbar","open","autoHideDuration","onClose","handleSnackbarClose","anchorOrigin","vertical","horizontal","Alert","severity"],"sourceRoot":""}